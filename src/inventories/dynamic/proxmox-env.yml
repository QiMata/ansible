# Proxmox Dynamic Inventory Configuration - Simple Version
# This version uses environment variables for security

plugin: community.proxmox.proxmox

# Use environment variables for sensitive data
url: "{{ lookup('env', 'PROXMOX_URL') | default('https://your-proxmox-server:8006') }}"
user: "{{ lookup('env', 'PROXMOX_USER') | default('ansible@pve') }}"
password: "{{ lookup('env', 'PROXMOX_PASSWORD') }}"

# SSL verification
validate_certs: "{{ lookup('env', 'PROXMOX_VALIDATE_CERTS') | default('false') | bool }}"

# Cache settings
cache: true
cache_plugin: jsonfile
cache_timeout: 3600
cache_connection: /tmp/ansible-proxmox-cache

# What to retrieve
want_facts: true
want_proxmox_nodes_ansible_host: true

# Grouping options
group_by_tags: true
group_by_status: true
group_by_type: true

# Compose variables for easier access
compose:
  ansible_host: proxmox_ipconfig0.ip | default(proxmox_net0.ip) | default(proxmox_name)
  vm_id: proxmox_vmid
  vm_name: proxmox_name
  vm_status: proxmox_status
  vm_tags: proxmox_tags

# Create groups based on Proxmox attributes
keyed_groups:
  # Group by status
  - key: proxmox_status
    prefix: status
  
  # Group by VM type
  - key: proxmox_type
    prefix: type
  
  # Group by tags
  - key: proxmox_tags
    prefix: tag
    separator: "_"

# Filters - uncomment and modify as needed
filters:
  # Only include running VMs
  - proxmox_status == "running"

