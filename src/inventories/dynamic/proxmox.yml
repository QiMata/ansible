# Proxmox Dynamic Inventory Configuration
plugin: community.proxmox.proxmox

# Proxmox connection details
url: https://10.80.0.1:8006
# user: ansible@pve  # or ansible@pam for local users
# password: your-password
# Alternatively, use token authentication (recommended):
vault_proxmox_token_id: ""
vault_proxmox_token_secret: ""

# SSL verification (set to false if using self-signed certificates)
validate_certs: false

# Cache settings (optional but recommended for performance)
cache: true
cache_plugin: jsonfile
cache_timeout: 3600
cache_connection: /tmp/ansible-proxmox-cache

# What to retrieve
want_facts: true
want_proxmox_nodes_ansible_host: true

# Grouping options
group_by_tags: true
group_by_status: true
group_by_type: true

# Compose variables for easier access
compose:
  ansible_host: proxmox_ipconfig0.ip | default(proxmox_net0.ip) | default(proxmox_name)
  vm_id: proxmox_vmid
  vm_name: proxmox_name
  vm_status: proxmox_status
  vm_tags: proxmox_tags

# Create groups based on Proxmox attributes
keyed_groups:
  # Group by status (running, stopped, etc.)
  - key: proxmox_status
    prefix: status
  
  # Group by VM type (qemu, lxc)
  - key: proxmox_type
    prefix: type
  
  # Group by tags if they exist
  - key: proxmox_tags
    prefix: tag
    separator: "_"

# Only include running VMs/containers by default
filters:
  # Uncomment the line below to only include running VMs
  # - proxmox_status == "running"
  
  # You can add more filters here based on your needs
  # - proxmox_name is match("^prod-.*")  # Only VMs starting with "prod-"

