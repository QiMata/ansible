---
- name: Restart Apache
  ansible.builtin.service:
    name: apache2
    state: restarted

- name: restart apache2
  ansible.builtin.service:
    name: apache2
    state: restarted

- name: reload systemd
  ansible.builtin.systemd:
    daemon_reload: true

- name: restart apt-mirror-health
  ansible.builtin.service:
    name: apt-mirror-health
    state: restarted

- name: restart apt-mirror-metrics
  ansible.builtin.service:
    name: apt-mirror-metrics
    state: restarted

- name: restart apt-mirror-discovery
  ansible.builtin.service:
    name: apt-mirror-discovery
    state: restarted

- name: restart apt-mirror-analytics
  ansible.builtin.service:
    name: apt-mirror-analytics
    state: restarted

- name: restart apt-mirror-alerts
  ansible.builtin.service:
    name: apt-mirror-alerts
    state: restarted
  failed_when: false
  ignore_errors: true

# Triggered after templating /etc/apt/mirror.list; optional to avoid long runs in CI
- name: run initial mirror
  ansible.builtin.command: apt-mirror
  become: true
  become_user: apt-mirror
  args:
    chdir: "{{ apt_mirror_base_path }}"
  when: (apt_mirror_initial_sync | default(false)) | bool

# Alias to match notify name used in tasks/apache.yml
- name: restart apache
  ansible.builtin.service:
    name: apache2
    state: restarted
