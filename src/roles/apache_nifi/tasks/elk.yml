---
- name: Install Filebeat
  ansible.builtin.apt:
    name: filebeat
    state: present
    update_cache: yes

- name: Configure Filebeat for NiFi logs
  ansible.builtin.copy:
    dest: /etc/filebeat/filebeat.yml
    owner: root
    group: root
    mode: "0644"
    content: |
      filebeat.inputs:
        - type: log
          enabled: true
          paths:
            - "{{ nifi_home }}/logs/*.log"

      output.logstash:
        hosts: ["{{ elk_logstash_host }}:{{ elk_logstash_port }}"]
  notify: restart filebeat

- name: Enable and start Filebeat
  ansible.builtin.systemd:
    name: filebeat
    state: started
    enabled: yes
