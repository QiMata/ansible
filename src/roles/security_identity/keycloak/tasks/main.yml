---
# Pre-flight checks and validation
- name: Include pre-flight checks
  ansible.builtin.include_tasks: preflight.yml
  when: keycloak_preflight_checks | bool

# System setup
- name: Include system setup tasks
  ansible.builtin.include_tasks: system.yml

# Database setup
- name: Include database setup tasks
  ansible.builtin.include_tasks: database.yml
  when: keycloak_db_create | bool

# Keycloak installation
- name: Include installation tasks
  ansible.builtin.include_tasks: install.yml

# TLS/HTTPS configuration
- name: Include TLS configuration tasks
  ansible.builtin.include_tasks: tls.yml
  when: keycloak_enable_https | bool

# Clustering configuration
- name: Include clustering configuration tasks
  ansible.builtin.include_tasks: cluster.yml
  when: keycloak_cluster_enabled | bool

# Configuration and service setup
- name: Include configuration tasks
  ansible.builtin.include_tasks: configure.yml

# Admin user creation
- name: Include admin user creation tasks
  ansible.builtin.include_tasks: admin.yml
  when: keycloak_create_admin | bool

# Theme and customization
- name: Include theme and customization tasks
  ansible.builtin.include_tasks: themes.yml
  when: keycloak_custom_themes | length > 0 or keycloak_custom_providers | length > 0

# Realm imports
- name: Include realm import tasks
  ansible.builtin.include_tasks: realms.yml
  when: keycloak_realm_imports | length > 0

# Firewall configuration
- name: Include firewall configuration tasks
  ansible.builtin.include_tasks: firewall.yml
  when: keycloak_configure_firewall | bool

# Backup configuration
- name: Include backup configuration tasks
  ansible.builtin.include_tasks: backup.yml
  when: keycloak_backup_enabled | bool

# Monitoring setup
- name: Include monitoring setup tasks
  ansible.builtin.include_tasks: monitoring.yml
  when: keycloak_monitoring_enabled | bool

# Version cleanup
- name: Include version cleanup tasks
  ansible.builtin.include_tasks: cleanup.yml
  when: keycloak_cleanup_old_versions | bool
