---
- name: Converge
  hosts: keycloak-db-test
  become: true
  pre_tasks:
    - name: Wait for PostgreSQL to be ready
      ansible.builtin.wait_for:
        host: postgres-db-test
        port: 5432
        timeout: 60

  roles:
    - role: keycloak
      vars:
        # Basic configuration
        keycloak_db_host: postgres-db-test
        keycloak_db_port: 5432
        keycloak_db_name: keycloak_test
        keycloak_db_user: keycloak_user
        keycloak_db_password: keycloak_pass
        keycloak_hostname: keycloak-db-test
        
        # Database creation
        keycloak_db_create: true
        keycloak_db_admin_user: postgres
        keycloak_db_admin_password: postgres
        
        # Admin user
        keycloak_create_admin: true
        keycloak_admin_user: admin
        keycloak_admin_password: admin123
        
        # Disable firewall for testing
        keycloak_configure_firewall: false
        
        # Enable validation
        keycloak_validate_config: true
        keycloak_preflight_checks: true
