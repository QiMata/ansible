---
- name: Converge
  hosts: all
  become: true
  vars:
    # Test basic configuration with monitoring and backup enabled
    vault_enable_telemetry: true
    vault_enable_backup: true
    vault_log_level: "DEBUG"
    
    # Test basic auth method
    vault_auth_methods:
      - name: "userpass"
        type: "userpass"
        users:
          - username: "testuser"
            password: "testpass"
            policies: ["default"]
    
    # Test basic secrets engine
    vault_secrets_engines:
      - name: "kv"
        type: "kv-v2"
        path: "secret"
    
    # Test policies
    vault_policies:
      - name: "test-policy"
        policy: |
          path "secret/data/test/*" {
            capabilities = ["create", "read", "update", "delete", "list"]
          }
    
    # Test audit device
    vault_audit_devices:
      - name: "file"
        type: "file"
        path: "/var/log/vault/audit.log"
    
  roles:
    - vault
