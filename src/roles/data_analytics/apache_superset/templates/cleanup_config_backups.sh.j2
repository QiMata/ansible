#!/bin/bash
# Cleanup old configuration backups

set -e

BACKUP_DIR="{{ superset_config_backup_path }}"
RETENTION_DAYS="{{ superset_config_backup_retention_days }}"

if [ ! -d "${BACKUP_DIR}" ]; then
  echo "Backup directory does not exist: ${BACKUP_DIR}"
  exit 0
fi

echo "Cleaning up configuration backups older than ${RETENTION_DAYS} days from ${BACKUP_DIR}"

# Remove old backup files
find "${BACKUP_DIR}" -name "superset_config_*.tar.gz" -mtime +${RETENTION_DAYS} -delete
find "${BACKUP_DIR}" -name "superset_scripts_*.tar.gz" -mtime +${RETENTION_DAYS} -delete

echo "Configuration backup cleanup completed at $(date)"
