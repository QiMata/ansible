---
# Configure autoscaling scripts and configuration
- name: Deploy autoscaling configuration
  ansible.builtin.template:
    src: autoscaling.conf.j2
    dest: /opt/spark-autoscaling/autoscaling.conf
    owner: spark-autoscaler
    group: spark-autoscaler
    mode: '0644'

- name: Deploy main autoscaling script
  ansible.builtin.template:
    src: spark_autoscaler.py.j2
    dest: /opt/spark-autoscaling/scripts/spark_autoscaler.py
    owner: spark-autoscaler
    group: spark-autoscaler
    mode: '0755'

- name: Deploy scaling provider scripts
  ansible.builtin.template:
    src: "{{ item }}.j2"
    dest: "/opt/spark-autoscaling/scripts/{{ item }}"
    owner: spark-autoscaler
    group: spark-autoscaler
    mode: '0755'
  loop:
    - scale_up.sh
    - scale_down.sh
    - metrics_collector.sh

- name: Deploy cloud provider specific scripts
  ansible.builtin.template:
    src: "providers/{{ spark_autoscaling_provider }}_provider.py.j2"
    dest: "/opt/spark-autoscaling/scripts/{{ spark_autoscaling_provider }}_provider.py"
    owner: spark-autoscaler
    group: spark-autoscaler
    mode: '0755'
  when: spark_autoscaling_provider != "manual"
