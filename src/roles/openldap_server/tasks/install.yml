---
- name: Preseed slapd debconf
  ansible.builtin.debconf:
    name: slapd
    question: "{{ item.question }}"
    value: "{{ item.value }}"
    vtype: "{{ item.vtype }}"
  loop:
    - { question: "slapd/domain", value: "{{ ldap_domain }}", vtype: "string" }
    - { question: "slapd/password1", value: "{{ ldap_admin_password }}", vtype: "password" }
    - { question: "slapd/password2", value: "{{ ldap_admin_password }}", vtype: "password" }
    - { question: "slapd/no_configuration", value: "false", vtype: "boolean" }

- name: Install OpenLDAP server packages
  ansible.builtin.apt:
    name: [ slapd, ldap-utils ]
    state: present
    update_cache: yes

- name: Ensure slapd service started
  ansible.builtin.service:
    name: slapd
    state: started
    enabled: yes
