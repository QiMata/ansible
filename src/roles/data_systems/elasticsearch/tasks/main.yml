---
# ============================================================================
# MAIN TASK ORCHESTRATION
# ============================================================================

- name: Include validation tasks
  ansible.builtin.import_tasks: validation.yml
  when: elasticsearch_validate_config
  tags: [validation, always]

- name: Include install tasks
  ansible.builtin.import_tasks: install.yml
  tags: install

- name: Include storage configuration tasks
  ansible.builtin.import_tasks: storage.yml
  tags: [storage, config]

- name: Include config tasks
  ansible.builtin.import_tasks: config.yml
  tags: config

- name: Include performance tuning tasks
  ansible.builtin.import_tasks: performance.yml
  tags: [performance, config]

- name: Include plugin management tasks
  ansible.builtin.import_tasks: plugins.yml
  when: elasticsearch_plugins | length > 0 or elasticsearch_plugins_remove | length > 0
  tags: plugins

- name: Include security tasks
  ansible.builtin.import_tasks: security.yml
  when: elasticsearch_enable_security
  tags: security

- name: Include monitoring tasks
  ansible.builtin.import_tasks: monitoring.yml
  when: elasticsearch_enable_monitoring or elasticsearch_watcher_enabled
  tags: monitoring

- name: Include index templates tasks
  ansible.builtin.import_tasks: templates.yml
  when: elasticsearch_index_templates | length > 0 or elasticsearch_component_templates | length > 0 or elasticsearch_index_lifecycle_policies | length > 0
  tags: templates

- name: Include snapshot configuration tasks
  ansible.builtin.import_tasks: snapshots.yml
  when: elasticsearch_snapshot_repositories | length > 0 or elasticsearch_snapshot_policies | length > 0
  tags: snapshots

- name: Include health check tasks
  ansible.builtin.import_tasks: health_checks.yml
  when: elasticsearch_health_check_enabled
  tags: [health, validation]
