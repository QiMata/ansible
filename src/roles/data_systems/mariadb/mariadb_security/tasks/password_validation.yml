---
# Password Validation Tasks

- name: Install password validation plugin
  community.mysql.mysql_query:
    login_unix_socket: /var/run/mysqld/mysqld.sock
    query: "INSTALL PLUGIN simple_password_check SONAME 'simple_password_check'"
  ignore_errors: true

- name: Configure password validation settings
  community.mysql.mysql_variables:
    login_unix_socket: /var/run/mysqld/mysqld.sock
    variable: "{{ item.variable }}"
    value: "{{ item.value }}"
  loop:
    - { variable: "simple_password_check_minimal_length", value: "{{ mariadb_password_validation_length }}" }
    - { variable: "simple_password_check_digits", value: "{{ mariadb_password_validation_number_count }}" }
    - { variable: "simple_password_check_letters_same_case", value: "{{ mariadb_password_validation_mixed_case_count }}" }
    - { variable: "simple_password_check_other_characters", value: "{{ mariadb_password_validation_special_char_count }}" }
  notify: restart mariadb

- name: Create password validation configuration file
  ansible.builtin.template:
    src: password_validation.cnf.j2
    dest: /etc/mysql/mariadb.conf.d/50-password-validation.cnf
    owner: root
    group: root
    mode: '0644'
  notify: restart mariadb
