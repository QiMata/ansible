;; PgBouncer configuration file
;; Managed by Ansible - Do not edit manually

[databases]
{% for db in postgresql_pgbouncer_databases %}
{{ db.name }} = host={{ db.host }} port={{ db.port }} pool_size={{ db.pool_size | default(postgresql_pgbouncer_default_pool_size) }}
{% endfor %}

[pgbouncer]
;;;
;;; Administrative settings
;;;

logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = {{ postgresql_pgbouncer_pidfile }}

;;;
;;; Where to wait for clients
;;;

listen_addr = {{ postgresql_pgbouncer_listen_addr }}
listen_port = {{ postgresql_pgbouncer_port }}

;;;
;;; Authentication settings
;;;

auth_type = {{ postgresql_pgbouncer_auth_type }}
auth_file = {{ postgresql_pgbouncer_auth_file }}

;;;
;;; Users allowed into database 'pgbouncer'
;;;

admin_users = {{ postgresql_pgbouncer_admin_users }}
stats_users = {{ postgresql_pgbouncer_stats_users }}

;;;
;;; Pooler personality questions
;;;

pool_mode = {{ postgresql_pgbouncer_pool_mode }}
server_reset_query = DISCARD ALL
server_check_query = select 1
server_check_delay = 30
application_name_add_host = {{ postgresql_pgbouncer_application_name_add_host }}

;;;
;;; Connection limits
;;;

max_client_conn = {{ postgresql_pgbouncer_max_client_conn }}
default_pool_size = {{ postgresql_pgbouncer_default_pool_size }}
min_pool_size = {{ postgresql_pgbouncer_min_pool_size }}
reserve_pool_size = {{ postgresql_pgbouncer_reserve_pool_size }}
reserve_pool_timeout = {{ postgresql_pgbouncer_reserve_pool_timeout }}
max_db_connections = {{ postgresql_pgbouncer_max_db_connections }}
max_user_connections = {{ postgresql_pgbouncer_max_user_connections }}

;;;
;;; Timeouts
;;;

server_lifetime = {{ postgresql_pgbouncer_server_lifetime }}
server_idle_timeout = {{ postgresql_pgbouncer_server_idle_timeout }}
client_idle_timeout = {{ postgresql_pgbouncer_client_idle_timeout }}
client_login_timeout = {{ postgresql_pgbouncer_client_login_timeout }}
query_timeout = {{ postgresql_pgbouncer_query_timeout }}
query_wait_timeout = {{ postgresql_pgbouncer_query_wait_timeout }}
cancel_wait_timeout = {{ postgresql_pgbouncer_cancel_wait_timeout }}
suspend_timeout = {{ postgresql_pgbouncer_suspend_timeout }}

;;;
;;; Logging
;;;

log_connections = {{ postgresql_pgbouncer_log_connections }}
log_disconnections = {{ postgresql_pgbouncer_log_disconnections }}
log_pooler_errors = {{ postgresql_pgbouncer_log_pooler_errors }}
log_stats = {{ postgresql_pgbouncer_log_stats }}
stats_period = {{ postgresql_pgbouncer_stats_period }}
verbose = 0

;;;
;;; Performance settings
;;;

listen_backlog = {{ postgresql_pgbouncer_listen_backlog }}
sbuf_loopcnt = {{ postgresql_pgbouncer_sbuf_loopcnt }}

;;;
;;; TCP settings
;;;

tcp_defer_accept = {{ postgresql_pgbouncer_tcp_defer_accept }}
tcp_keepalive = {{ postgresql_pgbouncer_tcp_keepalive }}
tcp_keepcnt = {{ postgresql_pgbouncer_tcp_keepcnt }}
tcp_keepidle = {{ postgresql_pgbouncer_tcp_keepidle }}
tcp_keepintvl = {{ postgresql_pgbouncer_tcp_keepintvl }}

{% if postgresql_ssl_enabled | default(false) %}
;;;
;;; TLS settings
;;;

server_tls_sslmode = {{ postgresql_pgbouncer_server_tls_sslmode }}
{% if postgresql_pgbouncer_server_tls_ca_file %}
server_tls_ca_file = {{ postgresql_pgbouncer_server_tls_ca_file }}
{% endif %}
{% if postgresql_pgbouncer_server_tls_cert_file %}
server_tls_cert_file = {{ postgresql_pgbouncer_server_tls_cert_file }}
{% endif %}
{% if postgresql_pgbouncer_server_tls_key_file %}
server_tls_key_file = {{ postgresql_pgbouncer_server_tls_key_file }}
{% endif %}
{% endif %}
