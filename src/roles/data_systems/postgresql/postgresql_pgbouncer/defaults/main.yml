---
# PgBouncer Configuration
pgbouncer_enabled: true
pgbouncer_version: "1.21.0"
pgbouncer_port: 6432
pgbouncer_listen_addr: "0.0.0.0"
pgbouncer_auth_type: "scram-sha-256"
pgbouncer_auth_file: "/etc/pgbouncer/userlist.txt"

# Pool configuration
pgbouncer_pool_mode: "transaction"  # session, transaction, statement
pgbouncer_max_client_conn: 100
pgbouncer_default_pool_size: 20
pgbouncer_min_pool_size: 5
pgbouncer_reserve_pool_size: 5
pgbouncer_reserve_pool_timeout: 5

# Connection limits
pgbouncer_max_db_connections: 50
pgbouncer_max_user_connections: 50

# Timeouts (in seconds)
pgbouncer_server_lifetime: 3600
pgbouncer_server_idle_timeout: 600
pgbouncer_client_idle_timeout: 0
pgbouncer_client_login_timeout: 60
pgbouncer_query_timeout: 0
pgbouncer_query_wait_timeout: 120
pgbouncer_cancel_wait_timeout: 10

# Logging
pgbouncer_log_connections: 1
pgbouncer_log_disconnections: 1
pgbouncer_log_pooler_errors: 1
pgbouncer_log_stats: 1
pgbouncer_stats_period: 60

# Admin interface
pgbouncer_admin_users: "postgres"
pgbouncer_stats_users: "postgres"

# SSL configuration (when PostgreSQL SSL is enabled)
pgbouncer_server_tls_sslmode: "prefer"
pgbouncer_server_tls_ca_file: ""
pgbouncer_server_tls_cert_file: ""
pgbouncer_server_tls_key_file: ""

# Database connections
pgbouncer_databases:
  - name: "{{ postgresql_database | default('postgres') }}"
    host: "127.0.0.1"
    port: "{{ postgresql_port | default(5432) }}"
    pool_size: "{{ pgbouncer_default_pool_size }}"

# Users (will be populated from PostgreSQL)
pgbouncer_users: []

# Performance tuning
pgbouncer_application_name_add_host: 1
pgbouncer_conffile: "/etc/pgbouncer/pgbouncer.ini"
pgbouncer_pidfile: "/var/run/postgresql/pgbouncer.pid"
pgbouncer_listen_backlog: 128
pgbouncer_sbuf_loopcnt: 5
pgbouncer_suspend_timeout: 10
pgbouncer_tcp_defer_accept: 1
pgbouncer_tcp_keepalive: 1
pgbouncer_tcp_keepcnt: 3
pgbouncer_tcp_keepidle: 600
pgbouncer_tcp_keepintvl: 30
