#!/bin/bash
# Neo4j Pre-Start Check Script
# Generated by Ansible

set -euo pipefail

echo "Running Neo4j pre-start checks..."

{% for service in neo4j_depends_on_services %}
{% if service.type | default('port') == 'port' %}
# Check {{ service.name | default('service') }} availability
echo "Checking {{ service.name | default('service') }} on {{ service.host | default('localhost') }}:{{ service.port }}..."
if ! nc -z {{ service.host | default('localhost') }} {{ service.port }}; then
    echo "✗ {{ service.name | default('service') }} is not available"
    exit 1
fi
echo "✓ {{ service.name | default('service') }} is available"

{% elif service.type == 'http' %}
# Check {{ service.name | default('service') }} HTTP endpoint
echo "Checking {{ service.name | default('service') }} at {{ service.url }}..."
if ! curl -f -s "{{ service.url }}" > /dev/null; then
    echo "✗ {{ service.name | default('service') }} HTTP check failed"
    exit 1
fi
echo "✓ {{ service.name | default('service') }} HTTP check passed"

{% elif service.type == 'command' %}
# Run custom command check for {{ service.name | default('service') }}
echo "Running custom check for {{ service.name | default('service') }}..."
if ! {{ service.command }}; then
    echo "✗ {{ service.name | default('service') }} custom check failed"
    exit 1
fi
echo "✓ {{ service.name | default('service') }} custom check passed"

{% endif %}
{% endfor %}

echo "All pre-start checks passed successfully"
exit 0
