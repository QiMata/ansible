---
- name: Set SSL mode
  ansible.builtin.uri:
    url: "https://api.cloudflare.com/client/v4/zones/{{ cloudflare_zone_id }}/settings/ssl"
    method: PATCH
    headers:
      Authorization: "Bearer {{ cloudflare_api_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      value: "{{ cloudflare_ssl_mode }}"
  register: cloudflare_ssl_update_result
  changed_when: cloudflare_ssl_update_result.json.result.value != cloudflare_ssl_mode

- name: Enable / Disable Always Use HTTPS
  ansible.builtin.uri:
    url: "https://api.cloudflare.com/client/v4/zones/{{ cloudflare_zone_id }}/settings/always_use_https"
    method: PATCH
    headers:
      Authorization: "Bearer {{ cloudflare_api_token }}"
      Content-Type: "application/json"
    body_format: json
    body:
      value: "{{ 'on' if cloudflare_always_use_https else 'off' }}"
  register: cloudflare_https_toggle_result
  changed_when: cloudflare_https_toggle_result.json.result.value != ('on' if cloudflare_always_use_https else 'off')
