---
- name: Hardened Neo4j node image (install-only)
  hosts: all
  become: true
  vars:
    # Common Neo4j ports; closed unless -e image_open_service_ports=true
    image_service_ports: [7474, 7687]
  roles:
    - role: update_system
    - role: remove_unnecessary_packages
    - role: sshd
      when: ansible_service_mgr | default('') == 'systemd'
    - role: ufw
      vars:
        ufw_allow_ports: "{{ (image_open_service_ports | default(false)) | ternary(image_service_ports, []) }}"
      when: image_configure_firewall | default(false)
    - role: base

  tasks:
    - name: Install Neo4j (no service start)
      ansible.builtin.import_role:
        name: neo4j
        tasks_from: install

    - name: Place base configuration (no service start)
      ansible.builtin.import_role:
        name: neo4j
        tasks_from: configure

    # Cluster/security/tuning can be applied per-environment later.
